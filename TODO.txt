# TODO
- [ ] [lsp] utf16 position encoding support
- [ ] [lsp] textDocument/didClose
- [ ] [lsp] textDocument/publishDiagnostics
- [ ] [tree-sitter][bug] ts_custom_alloc leak
- [ ] command palette
- [ ] build/task/command runner
- [ ] vscode tasks.json support
- [ ] vscode worksapce support
- [ ] visual studio .sln support
- [ ] project search
- [ ] buffer search-replace
- [ ] project search-replace
- [ ] navigation/jump history
- [ ] [history] serialise edit history
- [ ] [history] memory allocator/memory layout improvements
- [ ] serialise navigation/jump history
- [ ] [lsp] add a memory arena/allocator per lsp connection for fast and easy memory management of connections as they close and open
- [ ] [memory] arena/allocator per buffer for better and easier management of per buffer memory (line offsets, history, syntax trees, etc)
- [ ] prompt to convert buffers with mixed newline character modes
- [ ] handle buffer line offsets updating when newlines are inserted or removed in buffer_insert and buffer_remove
- [ ] go over and verify the logic of recalc_line_wrap when inserted or removed text includes one or more newlines
- [ ] [json] introduce serializer state such that commas and other separators can be automatically inserted
- [ ] [lsp] per-buffer configured LSP server
    - different buffers may belong to different workspaces
    - different workspaces may use different language servers for the same language
        - how true is this?
- [ ] [lsp] add support for work done tokens
- [ ] [lsp] add support for partial result tokens
- [ ] [lsp] asynchronous requests

# DOING
- [ ] [lsp] textDocument/definition
    - [x] send request
    - [x] parse request
        - assumes array of locations, even if only one location is received
    - [x] open file of location
        - hacky conversion from uri to path by stripping "file:///" prefix
    - [ ] goto line:col of location

# DONE
- [x] [lsp] verify/handle LSP text/position encoding handling when sending text across
    - does the text encoding in didOpen depend on the agreed upon position encoding? yes
    - does the text encoding in didChange depend on the agreed upon position encoding? yes
- [x] [lsp] the lsp connections needs to be per language so I can access it like app.lsp[buffer->language]
    - can we share a LSP connection across several languages if they use the same LSP server?
- [x] [lsp] textDocument/didSave
- [x] [lsp] textDocument/willSave
    - stub implementation as clangd does not require it and I want a proper test case
- [x] [lsp] textDocument/didChange
- [x] [clangd] negotiate utf8 offsetEncoding
    - extension added to clangd before positionEncoding became a thing
- [x] [bug] investigate memory leak
- [x] [lsp] TextDocumentIdentifier management
    - mapping BufferId <-> LspVersionedDocumentIdentifier
    - add mapping in lsp_open, making the text document identifers specific to the LspConnection
    - e.g. didCange specifies documents needs to be "owned" by the client by signalling didOpen
- [x] add unwrapped line begin/start information to buffers
    -  --currently storing line information in the view with flags for whether the line is wrapped or not--
    -  needed by e.g. LSP document position information, regardless of whether the buffer is opened in a view or not
